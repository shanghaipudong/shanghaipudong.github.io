<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>炫彩小球</title>

    <style>
      * {
        padding: 0;
        margin: 0;
      }

      body {
        background-color: aliceblue;
      }

      .ball {
        position: absolute;
        border-radius: 50%;
      }
    </style>
  </head>

  <body>
    <script>
      //小球类
      function Ball(x, y) {
        this.x = x;
        this.y = y;
        this.radius = 20;
        this.color = colorArr[Math.floor(Math.random() * colorArr.length)];
        this.opacity = 1;
        this.init();
        ballArr.push(this);
      }
      //初始化方法
      Ball.prototype.init = function () {
        this.dom = document.createElement("div");
        this.dom.className = "ball";

        do {
          this.dx = Math.floor(Math.random() * 20) - 10;
          this.dy = Math.floor(Math.random() * 20) - 10;
        } while (this.dx == 0 && this.dy == 0);

        this.dom.style.width = this.radius * 2 + "px";
        this.dom.style.height = this.radius * 2 + "px";
        this.dom.style.top = this.y - this.radius + "px";
        this.dom.style.left = this.x - this.radius + "px";
        this.dom.style.backgroundColor = this.color;

        document.body.appendChild(this.dom);
      };
      //更新方法，不断改变小球状态（大小、位置、透明度）
      Ball.prototype.update = function () {
        //改变小球大小、位置和透明度
        this.radius += 0.2;
        this.x += this.dx;
        this.y += this.dy;
        this.opacity -= 0.02;

        this.dom.style.width = this.radius * 2 + "px";
        this.dom.style.height = this.radius * 2 + "px";
        this.dom.style.top = this.y - this.radius + "px";
        this.dom.style.left = this.x - this.radius + "px";
        this.dom.style.opacity = this.opacity;

        //如果小球透明度小于0，那么把小球实例从数组和dom树上移除，提高性能，节省内存
        if (this.opacity < 0) {
          for (var i = 0; i < ballArr.length; i++) {
            if (ballArr[i] == this) {
              ballArr.splice(i, 1);
            }
          }
          document.body.removeChild(this.dom);
        }
      };
      //存放小球实例的数组
      var ballArr = [];
      //存放小球随机颜色的数组
      var colorArr = [
        "red",
        "orange",
        "yellow",
        "green",
        "greenyellow",
        "blue",
        "purple",
      ];
      //定时器，轮询遍历数组中取出小球实例，调用update方法，让小球运动
      setInterval(function () {
        for (var i = 0; i < ballArr.length; i++) {
          ballArr[i].update();
        }
      }, 20);

      //鼠标滑动事件，不断new出小球实例,并在小球创建过程中添加到ballArr数组
      document.onmousemove = function (e) {
        var x = e.clientX;
        var y = e.clientY;
        new Ball(x, y);
      };
    </script>
  </body>
</html>
